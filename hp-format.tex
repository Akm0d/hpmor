% This file includes all the generic formatting for HPatMoR. This mostly entails configuring
% the memoir package, though “configuring” on occasion means “completely messing it up”.

\RequirePackage{fmtcount}
\RequirePackage{calc}

%
% Fonts used generally (specific fonts used only once or twice are not here).
%
\usepackage{xltxtra}
\defaultfontfeatures{Ligatures={TeX}}
\setmainfont[
  Extension=.otf
, UprightFont=*-Regular
, ItalicFont=*-Italic
, BoldFont=*-Bold
, BoldItalicFont=*-BoldItalic
, SmallCapsFont=AlegreyaSC-Regular
]{Alegreya}

\newfontface\hpfont[ExternalLocation]{Lumos}

\newfontface\ptsansi[ExternalLocation]{AlegreyaSans-Italic}
\newcommand\parsel[1]{{\ptsansi #1}}

%
% Lettrine font pick
%
\renewcommand{\LettrineFontHook}{\hpfont}
\renewcommand{\LettrineTextFont}{}

\newcommand\lettrinemph[3][]{\lettrine[#1]{#2}{\emph{#3}}}
\renewcommand{\DefaultLoversize}{.1}
\renewcommand{\DefaultLraise}{0}


%%%%%%%%%%%%%
\setlength{\emergencystretch}{.06\textwidth}

% Allow linebreaks after em-dash and hyphens, except when they’re followed by punctuation

\newXeTeXintercharclass \punctuationClass

\XeTeXcharclass `\’ \punctuationClass
\XeTeXcharclass `\‘ \punctuationClass
\XeTeXcharclass `\“ \punctuationClass
\XeTeXcharclass `\” \punctuationClass
\XeTeXcharclass `\. \punctuationClass
\XeTeXcharclass `\, \punctuationClass
\XeTeXcharclass `\: \punctuationClass
\XeTeXcharclass `\? \punctuationClass
\XeTeXcharclass `\! \punctuationClass
\XeTeXcharclass `\: \punctuationClass

\newXeTeXintercharclass \digitClass
\XeTeXcharclass `\0 \digitClass
\XeTeXcharclass `\1 \digitClass
\XeTeXcharclass `\2 \digitClass
\XeTeXcharclass `\3 \digitClass
\XeTeXcharclass `\4 \digitClass
\XeTeXcharclass `\5 \digitClass
\XeTeXcharclass `\6 \digitClass
\XeTeXcharclass `\7 \digitClass
\XeTeXcharclass `\8 \digitClass
\XeTeXcharclass `\9 \digitClass

\newXeTeXintercharclass \dashClass
\XeTeXcharclass `\— \dashClass % em
\XeTeXcharclass `\– \dashClass % en
\XeTeXcharclass `\- \dashClass % hyphen

\XeTeXinterchartokenstate = 1

\def\morhyphenpenalty{75}
\exhyphenpenalty=10000

\XeTeXinterchartoks \dashClass 0 = {\hskip 0pt\penalty \morhyphenpenalty}

%
% Adjust space around lists
%
\setlength{\topsep}{.5\baselineskip plus 1\baselineskip minus .5\baselineskip}
\setlength{\partopsep}{.5\baselineskip plus 1\baselineskip minus .5\baselineskip}

\usepackage[normalem]{ulem}
\usepackage{xfrac}
\usepackage{censor}
\usepackage[useregional]{datetime2}
\usepackage[nopagecolor=white,pagecolor=white]{pagecolor}
\usepackage{afterpage}